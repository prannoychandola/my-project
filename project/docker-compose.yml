services:
  # ğŸ§  MongoDB Database
  mongo:
    image: mongo:6
    container_name: mongo
    restart: unless-stopped
    ports:
      - "27017:27017"
    volumes:
      - mongo_data:/data/db

  # ğŸ¤– Flask ML Microservice
  ml-service:
    build:
      context: ./ml-service
      dockerfile: Dockerfile
    container_name: ml-service
    restart: unless-stopped
    ports:
      - "5000:5000"
    depends_on:
      - mongo
    volumes:
      - ./ml-service/artifacts:/app/artifacts
      - ./ml-service/data:/app/data

  # âš™ï¸ Express + Mongo Backend
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: backend
    restart: unless-stopped
    env_file:
      - ./backend/.env.docker
    depends_on:
      - ml-service
      - mongo
    ports:
      - "8000:8000"

  # ğŸŒ React + Vite Frontend served by Nginx
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: frontend
    restart: unless-stopped
    depends_on:
      - backend
    ports:
      - "80:80"

  # â„¹ï¸ Info container (prints URLs neatly)
  info:
    image: alpine:3.18
    container_name: info
    entrypoint: ["/bin/sh", "-c"]
    command:
      - |
        echo "";
        echo "âœ… All services started successfully!";
        echo "";
        echo "ğŸŒ Frontend:       http://localhost";
        echo "âš™ï¸  Backend:        http://localhost:8000/api/health";
        echo "ğŸ¤– Flask ML API:   http://localhost:5000/api/predict";
        echo "ğŸ§  MongoDB:        mongodb://localhost:27017 (Compass)";
        echo "";
    depends_on:
      - frontend
      - backend
      - ml-service
      - mongo

volumes:
  mongo_data:
